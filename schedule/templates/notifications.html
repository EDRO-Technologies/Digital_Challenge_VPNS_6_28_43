{% load static %}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/notifications.css' %}"/>
    <title>Уведомления</title>
</head>
<body>
<header>
    <div class="header-left">
        <h1>Уведомления ваших групп</h1>
        <a href="{% url 'main:main' %}" class="nowbar1">Главная</a>
        <a href="{% url 'schedule:courses_list' %}" class="nowbar2">Курсы</a>
        <a href="{% url 'main:main' %}" class="nowbar1">Расписание</a>
        <div class="nowbar3">Расписание</div>
    </div>
    <div class="header-right">
        <div class="profile">
            <div class="avatar"></div>
        </div>
    </div>
</header>
<main>
    <section class="notifications-section">
        <h2>Уведомления которые вы писали</h2>
        <button class="add-notification-btn">Добавить уведомление</button>
        <div class="notification-list">
            <div class="notification-card unread">
                <div class="notification-content">
                    <h3>Изменение в расписании</h3>
                    <p>Лекция по Программированию перенесена на 11:00.</p>
                    <div class="notification-time">2 часа назад</div>
                </div>
                <div class="notification-actions">
                    <button class="btn btn-edit">Редактировать уведомление</button>
                    <button class="btn btn-delete">Удалить</button>
                </div>
            </div>
            <div class="notification-card unread">
                <div class="notification-content">
                    <h3>Новое задание</h3>
                    <p>Добавлено домашнее задание по Алгоритмам. Срок: 5 октября.</p>
                    <div class="notification-time">5 часов назад</div>
                </div>
                <div class="notification-actions">
                    <button class="btn btn-edit">Редактировать уведомление</button>
                    <button class="btn btn-delete">Удалить</button>
                </div>
            </div>
            <div class="notification-card unread">
                <div class="notification-content">
                    <h3>Напоминание</h3>
                    <p>Завтра в 10:00 семинар по Базам данных.</p>
                    <div class="notification-time">1 день назад</div>
                </div>
                <div class="notification-actions">
                    <button class="btn btn-edit">Редактировать уведомление</button>
                    <button class="btn btn-delete">Удалить</button>
                </div>
            </div>
            <div class="notification-card">
                <div class="notification-content">
                    <h3>Обновление курса</h3>
                    <p>Курс по Математике обновлен с новыми материалами.</p>
                    <div class="notification-time">3 дня назад</div>
                </div>
                <div class="notification-actions">
                    <button class="btn btn-edit">Редактировать уведомление</button>
                    <button class="btn btn-delete">Удалить</button>
                </div>
            </div>
            <div class="notification-card">
                <div class="notification-content">
                    <h3>Событие</h3>
                    <p>Хакатон начнется в пятницу в 18:00.</p>
                    <div class="notification-time">1 неделя назад</div>
                </div>
                <div class="notification-actions">
                    <button class="btn btn-edit">Редактировать уведомление</button>
                    <button class="btn btn-delete">Удалить</button>
                </div>
            </div>
        </div>
    </section>
</main>

<!-- Модальное окно -->
<div id="notificationModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modalTitle">Добавить уведомление</h2>
        <form id="notificationForm">
            <div class="form-group">
                <label for="title">Название уведомления:</label>
                <input type="text" id="title" name="title" required>
            </div>
            <div class="form-group">
                <label for="description">Описание:</label>
                <textarea id="description" name="description" rows="4" required></textarea>
            </div>
            <div class="form-group">
                <label for="time">Время написания:</label>
                <input type="text" id="time" name="time" readonly>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn" id="cancelBtn">Отмена</button>
                <button type="submit" class="btn" style="background-color: #7950F2; color: white;">Сохранить</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Элементы модального окна
    const modal = document.getElementById('notificationModal');
    const modalTitle = document.getElementById('modalTitle');
    const form = document.getElementById('notificationForm');
    const titleInput = document.getElementById('title');
    const descriptionInput = document.getElementById('description');
    const timeInput = document.getElementById('time');
    const cancelBtn = document.getElementById('cancelBtn');
    const closeBtn = document.querySelector('.close');

    // Кнопка добавить уведомление
    const addNotificationBtn = document.querySelector('.add-notification-btn');
    addNotificationBtn.addEventListener('click', () => {
        modalTitle.textContent = 'Добавить уведомление';
        form.reset();
        timeInput.value = new Date().toLocaleString('ru-RU');
        modal.style.display = 'block';
        form.dataset.editing = 'false';
    });

    // Кнопки редактировать
    const editButtons = document.querySelectorAll('.btn-edit');
    editButtons.forEach(button => {
        button.addEventListener('click', (e) => {
            const card = e.target.closest('.notification-card');
            const title = card.querySelector('h3').textContent;
            const description = card.querySelector('p').textContent;
            const time = card.querySelector('.notification-time').textContent;

            modalTitle.textContent = 'Редактировать уведомление';
            titleInput.value = title;
            descriptionInput.value = description;
            timeInput.value = time; // Оставляем время как есть, или можно обновить на текущее
            modal.style.display = 'block';
            form.dataset.editing = 'true';
            form.dataset.card = card;
        });
    });

    // Закрытие модального окна
    closeBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });
    cancelBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });
    window.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });

    // Сохранение формы
    form.addEventListener('submit', (e) => {
        e.preventDefault();
        const title = titleInput.value;
        const description = descriptionInput.value;
        const time = timeInput.value;

        if (form.dataset.editing === 'true') {
            // Редактирование
            const card = form.dataset.card;
            card.querySelector('h3').textContent = title;
            card.querySelector('p').textContent = description;
            card.querySelector('.notification-time').textContent = time;
        } else {
            // Создание нового
            const notificationList = document.querySelector('.notification-list');
            const newCard = document.createElement('div');
            newCard.className = 'notification-card unread';
            newCard.innerHTML = `
                <div class="notification-content">
                    <h3>${title}</h3>
                    <p>${description}</p>
                    <div class="notification-time">${time}</div>
                </div>
                <div class="notification-actions">
                    <button class="btn btn-edit">Редактировать уведомление</button>
                    <button class="btn btn-delete">Удалить</button>
                </div>
            `;
            notificationList.insertBefore(newCard, notificationList.firstChild);

            // Добавить обработчики для новых кнопок
            newCard.querySelector('.btn-edit').addEventListener('click', (e) => {
                const card = e.target.closest('.notification-card');
                const title = card.querySelector('h3').textContent;
                const description = card.querySelector('p').textContent;
                const time = card.querySelector('.notification-time').textContent;

                modalTitle.textContent = 'Редактировать уведомление';
                titleInput.value = title;
                descriptionInput.value = description;
                timeInput.value = time;
                modal.style.display = 'block';
                form.dataset.editing = 'true';
                form.dataset.card = card;
            });
            newCard.querySelector('.btn-delete').addEventListener('click', () => {
                newCard.remove();
            });
        }

        modal.style.display = 'none';
    });

    // Удаление уведомлений
    const deleteButtons = document.querySelectorAll('.btn-delete');
    deleteButtons.forEach(button => {
        button.addEventListener('click', () => {
            const card = button.closest('.notification-card');
            card.remove();
        });
    });
</script>
</body>
</html>